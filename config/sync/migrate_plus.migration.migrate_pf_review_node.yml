uuid: 5167083c-9979-497e-bdd5-936610ac2655
langcode: en
status: true
dependencies: {  }
id: migrate_pf_review_node
class: null
field_plugin_method: null
cck_plugin_method: null
migration_tags: null
migration_group: null
label: 'Migrate reviews from pf csv exports'
source:
  plugin: csv
  path: ../kaggle-data/csv/reviews.csv
  delimiter: ','
  header_row_count: 1
  ids:
    - review_url
process:
  title: titles
  type:
    plugin: default_value
    default_value: review
  field_artist_id: artist_id
  tmp_url_base:
    plugin: default_value
    default_value: 'https://www.pitchfork.com'
  field_review_url_id: review_url
  field_review_url:
    plugin: concat
    source:
      - '@tmp_url_base'
      - review_url
    skip_on_empty: false
  tmp_album_explode:
    -
      plugin: callback
      callable: json_decode
      source: tombstone_ids
  tmp_album_lookup:
    -
      plugin: migration_lookup
      migration: migrate_pf_albums_para
      source: '@tmp_album_explode'
  field_album_detail:
    -
      plugin: sub_process
      source: '@tmp_album_lookup'
      process:
        target_id: '0'
        target_revision_id: '1'
  tmp_artist_explode:
    -
      plugin: callback
      callable: json_decode
      source: artist_ids
  field_artist:
    plugin: entity_lookup
    value_key: field_artist_id
    bundle: artist
    entity_type: taxonomy_term
    ignore_case: true
    source: '@tmp_artist_explode'
  tmp_genre_explode:
    -
      plugin: callback
      callable: json_decode
      source: genres
  field_genre:
    plugin: entity_generate
    value_key: name
    bundle: genre
    entity_type: taxonomy_term
    ignore_case: true
    source: '@tmp_genre_explode'
  tmp_author_explode:
    -
      plugin: callback
      callable: json_decode
      source: authors
  field_author:
    plugin: entity_generate
    value_key: name
    bundle: author
    entity_type: taxonomy_term
    ignore_case: true
    source: '@tmp_author_explode'
  field_standard_review: is_standard_review
  field_publish_date:
    plugin: format_date
    source: pub_date
    from_format: 'Y-m-d H:i:s'
    to_format: 'Y-m-d\TH:i:s'
  created:
    plugin: format_date
    source: pub_date
    from_format: 'Y-m-d H:i:s'
    to_format: U
  field_review_body: body
destination:
  plugin: 'entity:node'
  default_bundle: review
idMap: {  }
migration_dependencies: null
include: null
